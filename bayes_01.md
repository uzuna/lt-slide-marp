---
marp: true
theme: statistics
pagination: true
---

# ベイズ統計入門 Vol.1

ベイズの定理と条件付き確率

---

## Topic

- ベイズ推定に触れる
- 条件付き確率とは
- ベイズの定理
- ベイズ更新

---

ベイズの定理を見てみる

ベイズの定理: $P(A|B) = \frac{P(B|A)P(A)}{P(B)}$

---

ベイズの定理: $P(A|B) = \frac{P(B|A)P(A)}{P(B)}$

- $P(A)$ 事象 A が起こる確率
- $P(B)$ 事象 B が起こる確率
- $P(B|A)$ 事象 A の下で事象 B が起こる条件付き確率
- $P(A|B)$ 事象 B の下で事象 A が起こる条件付き確率

---

なるほど、わからん。
事象とは?
条件付き確率って?
確率の定義ってなんだっけ?

---

# 条件付き確率

---

## 確率について

e.g.

- 降水確率 30%
- あるコインの表が出る確率
- 6 面サイコロで 1 が出る確率

---

確率とは **試行(trial)** によって得られた **事象(event)** の割合で表現される、**偶然起こる事象の起こりやすさの指標** (としておく。哲学的にいくつかの考察が存在する)

- 確率は記号$p$で表す
- 一般化すると事象を$A$とし、とりうる値を$U$とすると$p = \frac{A}{U}$
- コイントスで表が出る確率$p = \frac{表が出る}{表 or 裏} = \frac{1}{2}$
- 6 面サイコロで偶数が出る確率$p = \frac{\lbrace2,4,6\rbrace}{\lbrace 1, 2, 3,4,5, 6\rbrace} = \frac{3}{6}$

---

確率の種類

- 数学的確率
  - サイコロで偶数が出る確率$p = \frac{偶数事象の数}{起こりえるすべての事象} = \frac{3}{6}$
  - サイコロは **6 面あって偶数は{2,4,6}の 3 面を持つ**
  - **すべての面は一様な確率で発生する** という前提を置く
- 統計的確率
  - 降水確率 30%
  - 現在の気象状況では **過去の統計から 30%の割合** で雨が降っていた

---

長ったらしいので記号化します

- サイコロが偶数で出る事象を A とする
- その確率は$P(A)$と表記する
- サイコロで 4 以下の値が出る事象を B とする
- その確率は$P(B)$と表記する

同時確率

- 事象 A と B が同時に起こる確率$P(A \cap B)$
  - 事象が独立である場合

---

同時確率と条件付き確率

ベイズの定理: $P(A|B) = \frac{P(B|A)P(A)}{P(B)}$

- 同時確率$P(A \cap B)$ が部分となり、条件が全体となる
- $P(B|A)$とは A の下で B が起きる確率$A$の中の$P(B|A) = \frac{P(A \cap B)}{P(A)}$
- $P(A|B)$とは B の下で A が起きる確率$B$の中の$P(A|B) = \frac{P(A \cap B)}{P(B)}$

---

## サイコロを使った具体例その 1

- 事象 A を目が 4 以下であること
- 事象 B が偶数であることとする
- $P(A) = \frac{4}{6}$
- $P(B) = \frac{3}{6}$
- $P(A \cap B) = \frac{2}{6}$
- $P(B|A) = \frac{A \cap B}{P(A)} = \frac{2/6}{4/6} = \frac{1}{2}$
- $P(A|B) = \frac{A \cap B}{P(B)} = \frac{2/6}{3/6} = \frac{2}{3}$

---

最後の$P(A|B) = \frac{A \cap B}{P(B)} = \frac{2/6}{3/6} = \frac{2}{3}$というのはベイズの定理でも求められる

- ベイズの定理: $P(A|B) = \frac{P(B|A)P(A)}{P(B)}$

$P(A|B) = \frac{P(B|A)P(A)}{P(B)} = \frac{1/2 * 4/6}{3/6} = \frac{2}{3}$

全く普通のことだが何かすごいのか?

---

## サイコロを使った具体例その 2

6 面と 12 面の 2 つサイコロがあり 1/2 の確率で選ばれるとする。
1 回の試行で 3 以下の目がでた。この時 6 面と 12 面のどちらのサイコロだっただろうか?

- 事象 A は 6 面サイコロが選ばれた
- 事象 B を目が 3 以下であること

---

問題文からわかること

- $P(A) = \frac{1}{2}$ 6 面サイコロである確率
- $P(B|A) = \frac{3}{6} = \frac{1}{2}$ 6 面サイコロで 3 以下がでる確率
- $P(B|\overline{A}) = \frac{3}{12} =\frac{1}{4}$ 12 面サイコロで 3 以下がでる確率

計算で求められること

- サイコロの出目一つの確率が均一ではないので(つまり$\frac{3+3}{6+12}$ではない)
- サイコロの選ばれる確率が 1/2 の時に B を満たす確率
  - $P(B) = P(B|A)P(A) + P(B|\overline{A})P(\overline{A}) = \frac{1}{2}*\frac{3}{6}+\frac{1}{2} * \frac{3}{12} = \frac{9}{24}$
- サイコロが 6 面かつ目が 3 以下の確率
  - $P(A \cap B) =  P(B|A)P(A) = \frac{1}{4}$

---

- $P(A|B) = \frac{A \cap B}{P(B)} = \frac{1/4}{9/24} = \frac{6}{9}$
- $P(A|B) = \frac{P(B|A)P(A)}{P(B)} = \frac{1/2 * 1/2}{9/24} = \frac{6}{9}$

---

目が 3 以下が出た事象の下では、選ばれたのは 6 面サイコロであった確率$P(A|B)=\frac{6}{9}$は

- $P(A)=\frac{1}{2}$と問題では設定されていたが
- **観測された事象から推測すると** 6 面だった可能性が高そうだ

---

**観測された事象から推測すると** $P(A)=\frac{6}{9}$であるということ

- A によって B の起こりやすさが決まる
- A-->B という原因と結果の関係、時間の変化がある
- 逆に B の結果から原因 A の推測するというのは **時間を逆行する**
- 時間の変化も条件付き確率の一種なのでベイズの定理により求めることができる

---

ベイズの定理: $P(A|B) = \frac{P(B|A)P(A)}{P(B)}$のうち
A と B の解釈を **起きた事象** と **原因** とすることで原因の確率を計算できる

- B が起きたこと -> データ$D$
- A が条件とする -> D の起こった原因$H$

$P(H|D) = \frac{P(D|H)P(H)}{P(D)}$ これをベイズの公式とよぶ

---

ところで結局 6 面と 12 面のどちらだったのだろうか?

- $\frac{6}{9}$ではまだ何とも言えない
- もっと試行してみたらどちらだったのか分かるのではないか?

---

## ベイズ更新

先ほどの問題を変形して考える

- 6 面 と 12 面 の サイコロのどちらかが渡されたが知ることができない
- それぞれのサイコロの目の出やすさは均一とする
- 事象 H が 6 面サイコロが渡されていたとする
- 事象 D を目が 3 以下であること
- 試行したデータは $X = {\lbrace 1,4,3,1 \rbrace}$ とする

この時の選ばれたのが 6 面サイコロである確率 $P(H)$ を求めよ

---

- 分かること
  - $P(D|H) = \frac{3}{6}$ 6 面サイコロの面で 3 以下の確率
  - $P(D|\overline{H}) = \frac{3}{12}$ 6 面サイコロの面で 3 以下の確率
- 原因 H が特定できたときのデータの出やすさ(尤度):
  - $P(D|H) = \frac{3}{6}$
  - $P(\overline{D}|H) = \frac{3}{6}$
  - $P(D|\overline{H}) = \frac{3}{12}$
  - $P(\overline{D}|\overline{H}) = \frac{9}{12}$

---

### 事前確率

- $P(A)$はこれから知りたい値で何の情報もない
- しかし 2 つのサイコロから選ばれるという事前知識からすると半分の確率で選ばれると仮定してよいように思う(主観条件)
- なので $P(H) = \frac{1}{2}$ とする
- これが **事前確率**
- 上記の事前確率の時に 目が 3 以下になる確率
  - $P(D) = P(D|H)P(H) + P(D|\overline{H})P(\overline{H}) = \frac{3}{6} * \frac{1}{2} + \frac{3}{12} * \frac{1}{2} = \frac{9}{24}$

---

### 事後確率を求める(1 回目)

試行データ: $X = {\lbrace 1,4,3,1 \rbrace}$
$x_1=1$なので $D_1 = 1$
事後確率を計算すると

- $P(H|D_1 = 1) = \frac{P(D|H)P(H)}{P(D)} = \frac{1/2 * 1/2}{9/24} = \frac{24}{36}$
- $P(\overline{H}|D_1 = 1) = \frac{P(D|\overline{H})P(\overline{H})}{P(D)} = \frac{3/12 * 1/2}{9/24} = \frac{12}{36}$

$P(A)$は$\frac{1}{2}$から$\frac{24}{36}$に更新された

事後確率は次の事前確率を用いることができる

---

### 事後確率を求める(2 回目)

- $P(A)$が変化したので$P(D)$を更新
- $P(D) = P(D|H)P(H) + P(D|\overline{H})P(\overline{H}) = \frac{1}{2} * \frac{24}{36}+\frac{3}{12}*\frac{12}{36} = \frac{15}{36}$

$x_2=4$なので $D_2 = 0$

- $P(H|D_2 = 0) = \frac{P(\overline{D}|H)P(H)}{P(\overline{D})} = \frac{1/2 * 24/36}{10/24} = \frac{2}{5}$
- $P(\overline{H}|D_2 = 0) = \frac{P(\overline{D}|\overline{H})P(\overline{H})}{P(\overline{D})} = \frac{9/12 * 12/36}{10/24} = \frac{3}{5}$

---

試行データ: $X = {\lbrace 1,4,3,1 \rbrace}$ -> $D = {\lbrace 1,0,1,1 \rbrace}$
を適用していく毎に$P(A)$は
$\frac{1}{2} \rightarrow \frac{24}{36} \rightarrow \frac{4}{7} \rightarrow \frac{8}{11}$ と変化していく

この操作を **ベイズ更新** と呼ぶ

---

やったー!
これで発生確率を求められるつよつよツールを手に入れたぞ!

---

というわけにはならない

- そもそもとりうる値が網羅する情報持ってる仮定は厳しくない?
  - サイコロの目が出る確率が均一って本当にそうかー?
  - サイコロの数が不明なのが普通
  - サイコロの面も不明なのが普通
  - 主人公はいつだって運を味方につける
  - 現実は無常
- $D \in {\lbrace 0, 1 \rbrace}$なのに$8/11$という値は現実としてどう使うんだ?

---

先ほどまでの確率表記は数学的確率からなっている
-> データの特徴は教えてくれるが現実に適用が難しい

現実に起きたこと記述すると言えば統計的確率

- 起きた事象から確率分布を得て、確率分布を生み出すパラメータを推測したらいいのでは?
- ということは$P(H) = \frac{8}{11}$とは確率分布を生み出すパラメータなのでは?

---

## 次回、ベイズ統計

---

参考文献

> 『史上最強図解　これならわかるベイズ統計』著 涌井良幸・涌井貞美
> 『ベイズ推論による機械学習入門』著 須山敦志
> アイシア・ソリッド　「ベイズ統計シリーズ動画」
